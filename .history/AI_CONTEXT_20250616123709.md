# AI CONTEXT - LiteCMMS v2.0

> **INSTRUKCJA DLA AI**: Ten plik zawiera peÅ‚ny kontekst projektu. Przeczytaj go na poczÄ…tku kaÅ¼dej nowej sesji.

## ğŸ¯ PODSTAWOWE INFORMACJE

### Projekt

- **Nazwa**: LiteCMMS v2.0
- **Typ**: System CMMS (Computerized Maintenance Management System)
- **Cel**: Åšrednie przedsiÄ™biorstwa (do 50 uÅ¼ytkownikÃ³w)
- **Status**: Faza 6 ukoÅ„czona - infrastruktura gotowa

### JÄ™zyk komunikacji

- **ZAWSZE odpowiadaj po polsku** - gÅ‚Ã³wne wymaganie uÅ¼ytkownika

## ğŸ› ï¸ STACK TECHNICZNY

### Frontend

- Next.js 15 z App Router, TypeScript, Tailwind CSS
- WielojÄ™zycznoÅ›Ä‡: PL (domyÅ›lny), EN, DE
- Port: localhost:3000

### Backend

- Fastify, TypeScript, Prisma ORM
- CORS skonfigurowany, nodemon auto-restart
- Port: localhost:3001

### Baza Danych

- PostgreSQL 17
- Prisma z peÅ‚nÄ… strukturÄ… CMMS (493 linie schema)
- Port: localhost:5432

## âœ… AKTUALNY STAN SYSTEMU

### System w peÅ‚ni dziaÅ‚ajÄ…cy

1. **Frontend Next.js**: Localhost:3000, wielojÄ™zycznoÅ›Ä‡ PL/EN/DE
2. **Backend Fastify**: Localhost:3001, endpointy `/health`, `/api/status`, `/api/system-status`
3. **PostgreSQL 17**: Port 5432, baza `litecmms`, hasÅ‚o: `8C5c3Aab5`
4. **Prisma ORM**: Migracja `20250615205446_init`, wszystkie tabele CMMS
5. **DATABASE_URL**: âœ… PrawidÅ‚owo Å‚adowana z `database.env` (problem BOM rozwiÄ…zany)
6. **System Automatyzacji**: Komendy `npm run sys:*` dla zarzÄ…dzania procesami

### Endpointy

- **Health**: `GET /health`
- **Status API**: `GET /api/status`
- **System Status**: `GET /api/system-status`

## ğŸ”§ KONFIGURACJA

### Pliki kluczowe

- `package.json` - zaleÅ¼noÅ›ci i skrypty
- `prisma/schema.prisma` - schema PostgreSQL
- `server/index.ts` - gÅ‚Ã³wny serwer
- `database.env` - konfiguracja DATABASE_URL

### Skrypty npm (ZALECANE)

```bash
npm run sys:start    # Uruchom system (backend + frontend)
npm run sys:stop     # Zatrzymaj wszystkie procesy
npm run sys:restart  # Restart systemu
npm run sys:status   # Status wszystkich komponentÃ³w
```

### Backup skrypty (jeÅ›li sys:* nie dziaÅ‚ajÄ…)

```bash
npm run dev:server   # Backend w obecnym terminalu
npm run dev          # Frontend w osobnym terminalu
npm run stop-all     # Zatrzymaj wszystkie procesy
```

## ğŸ“ HISTORIA ROZWOJU (KLUCZOWE FAZY)

### Faza 1-4: Infrastruktura podstawowa (UKOÅƒCZONA âœ…)

- Serwer Fastify + CORS
- PostgreSQL 17 + Prisma
- Frontend Next.js + wielojÄ™zycznoÅ›Ä‡
- Komunikacja Frontend-Backend-Database

### Faza 5: System Automatyzacji (UKOÅƒCZONA âœ…)

- Skrypty PowerShell do zarzÄ…dzania procesami
- 8 komend npm (`sys:*`)
- Automatyczne rozwiÄ…zywanie konfliktÃ³w portÃ³w

### Faza 6: Naprawa DATABASE_URL (UKOÅƒCZONA âœ…)

- **Problem**: BOM (Byte Order Mark) w `database.env`
- **RozwiÄ…zanie**: UsuniÄ™to BOM, usuniÄ™to hardkodowany fallback
- **Rezultat**: `dotenv.config()` prawidÅ‚owo Å‚aduje DATABASE_URL

### ğŸ” Odkrycie gotowego systemu autoryzacji

- `server/routes/auth.ts` - endpointy login/register/logout/refresh
- `server/middleware/auth.ts` - JWT middleware + kontrola rÃ³l
- 5 poziomÃ³w rÃ³l: ADMINISTRATOR, MANAGER, OPERATOR, TECHNICIAN, REPORTS
- **ZaleÅ¼noÅ›ci zainstalowane**: `bcryptjs`, `jsonwebtoken`, `@fastify/jwt`, `zod`
- **Status**: Napisane ale nie zintegrowane z gÅ‚Ã³wnym serwerem

## ğŸš€ NASTÄ˜PNE KROKI

### Priorytet 1: Integracja autoryzacji

1. âœ… Modele uÅ¼ytkownikÃ³w - GOTOWE
2. âœ… Endpointy auth - NAPISANE
3. âœ… JWT middleware - NAPISANE
4. ğŸ”„ **DO ZROBIENIA - BÅÄ„D NA EKRANIE**: 
   - **Problem**: `Property 'prisma' does not exist on type 'FastifyInstance'`
   - **Przyczyna**: Prisma nie jest zarejestrowana jako plugin w Fastify
   - **RozwiÄ…zanie**: ZintegrowaÄ‡ Prisma Client z gÅ‚Ã³wnym serwerem
   - **Kroki**: 
     1. DodaÄ‡ `fastify.decorate('prisma', prisma)` w `server/index.ts`
     2. ZarejestrowaÄ‡ JWT plugin (`@fastify/jwt`)
     3. ZarejestrowaÄ‡ bcrypt plugin
     4. ZarejestrowaÄ‡ route'y autoryzacji
     5. PrzetestowaÄ‡ endpointy `/api/auth/register` i `/api/auth/login`

### Priorytet 2: FunkcjonalnoÅ›ci CMMS

1. ZarzÄ…dzanie maszynami
2. System zgÅ‚oszeÅ„ awarii
3. Zlecenia pracy (Work Orders)
4. Dashboard i raporty

## ğŸ¯ METODOLOGIA PRACY

### Wymagania uÅ¼ytkownika

1. **MaÅ‚e kroki z testami** - kaÅ¼da zmiana testowana
2. **Prawdziwe rozwiÄ…zania** - nie mock dane
3. **PostgreSQL** - definitywnie, nie SQLite
4. **BezpieczeÅ„stwo** - wszystko bezpieczne
5. **Cofanie zmian** - powrÃ³t do dziaÅ‚ajÄ…cego stanu

### Zasady kodowania

1. **WielojÄ™zycznoÅ›Ä‡**: Wszystkie teksty w `locales/*/common.json`
   - âŒ `<p>Tekst</p>` 
   - âœ… `<p>{t('klucz')}</p>`
2. **Struktura kluczy**: `sekcja.element` dla wszystkich jÄ™zykÃ³w (PL/EN/DE)

## ğŸ’¡ WSKAZÃ“WKI DLA AI

### Na poczÄ…tku sesji

1. SprawdÅº `npm run sys:status`
2. Przeczytaj logi terminala
3. **PRIORYTET**: Napraw bÅ‚Ä…d Prisma w Fastify (widzisz bÅ‚Ä™dy TypeScript na ekranie)
4. Zintegruj system autoryzacji z gÅ‚Ã³wnym serwerem
5. Przetestuj endpointy `/api/auth/*`

### âš ï¸ Problemy Å›rodowiska

1. **PowerShell**: BÅ‚Ä™dy PSReadLine - uÅ¼ywaj prostych komend
2. **DATABASE_URL**: UÅ¼ywa `database.env` (bez pliku `.env`)
3. **Uprawnienia**: NiektÃ³re operacje wymagajÄ… "Run as Administrator"

### âš ï¸ PRZED KOÅƒCEM SESJI - OBOWIÄ„ZKOWE!

**ZAWSZE przed koÅ„cem limitu chatu:**

1. **Zaktualizuj AI_CONTEXT.md**:
   - Dodaj nowe osiÄ…gniÄ™cia do sekcji "AKTUALNY STAN SYSTEMU"
   - Zaktualizuj "HISTORIA ROZWOJU" z nowymi fazami
   - Zaktualizuj "NASTÄ˜PNE KROKI" 
   - Dodaj nowe rozwiÄ…zania do "KLUCZOWE ROZWIÄ„ZANIA"

2. **Zaktualizuj README.md** (jeÅ›li potrzeba):
   - Nowe instrukcje instalacji
   - Zmiany w strukturze projektu  
   - Nowe endpointy/funkcjonalnoÅ›ci

3. **Poinformuj uÅ¼ytkownika**:
   - "ğŸ”„ **AKTUALIZUJÄ˜ PLIKI KONTEKSTU** przed koÅ„cem sesji"
   - Podsumuj co zostaÅ‚o zrobione
   - WskaÅ¼ co trzeba kontynuowaÄ‡ w nastÄ™pnej sesji

**PrzykÅ‚ad komunikatu:**
> ğŸ”„ **AKTUALIZUJÄ˜ PLIKI KONTEKSTU** przed koÅ„cem sesji  
> âœ… **OsiÄ…gniÄ™cia**: Autoryzacja zintegrowana, endpointy dziaÅ‚ajÄ…  
> âš ï¸ **Do kontynuacji**: Frontend logowania  
> ğŸ“ **Pliki zaktualizowane**: AI_CONTEXT.md, README.md

### Czego unikaÄ‡

- Nie zmieniaÄ‡ dziaÅ‚ajÄ…cych czÄ™Å›ci
- Nie proponowaÄ‡ SQLite
- **NIGDY nie hardkodowaÄ‡ tekstÃ³w**
- **âŒ NIE KOÅƒCZYÄ† SESJI bez aktualizacji kontekstu!**
- **âŒ NIE KOÅƒCZYÄ† bez komunikatu podsumowujÄ…cego!**

## ğŸ” DIAGNOSTYKA

### Sprawdzanie

- Frontend: http://localhost:3000
- Backend: http://localhost:3001/api/system-status
- Health: http://localhost:3001/health

### Typowe problemy

- Port zajÄ™ty â†’ restart serwera
- CORS errors â†’ sprawdziÄ‡ konfiguracjÄ™
- Database â†’ sprawdziÄ‡ `/api/system-status`

## ğŸ“‹ KLUCZOWE ROZWIÄ„ZANIA

1. **DATABASE_URL**: âœ… PrawidÅ‚owe Å‚adowanie z `database.env` (usuniÄ™to BOM)
2. **Konflikt portÃ³w**: Automatyczne rozwiÄ…zywanie w skryptach
3. **Kodowanie**: Wszystkie skrypty bez polskich znakÃ³w
4. **Migracje**: Pierwsza migracja `20250615205446_init` wykonana

## âŒ NIEUDANE PRÃ“BY - NIE POWTARZAÄ†

- **SQLite** - zbyt wiele ograniczeÅ„ (brak Json, enum, Decimal)
- **Docker** - problemy z uruchomieniem Docker Desktop
- **Plik `.env`** - nie istnieje, system uÅ¼ywa `database.env`

---

**Ostatnia aktualizacja**: StyczeÅ„ 2025 - Faza 6 ukoÅ„czona  
**Wersja kontekstu**: 2.0 - UporzÄ…dkowana  
**Status**: Aktualny - DATABASE_URL naprawiona, autoryzacja odkryta, gotowy do integracji 