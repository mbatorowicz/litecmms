# AI CONTEXT - LiteCMMS v2.0

> **INSTRUKCJA DLA AI**: Ten plik zawiera peÅ‚ny kontekst projektu. Przeczytaj go na poczÄ…tku kaÅ¼dej nowej sesji.

## ğŸ¯ PODSTAWOWE INFORMACJE

### Projekt

- **Nazwa**: LiteCMMS v2.0
- **Typ**: System CMMS (Computerized Maintenance Management System)
- **Cel**: Åšrednie przedsiÄ™biorstwa (do 50 uÅ¼ytkownikÃ³w)
- **Status**: W rozwoju - faza podstawowej infrastruktury

### JÄ™zyk komunikacji

- **ZAWSZE odpowiadaj po polsku** - to jest gÅ‚Ã³wne wymaganie uÅ¼ytkownika
- UÅ¼ytkownik mÃ³wi po polsku i oczekuje odpowiedzi w tym jÄ™zyku

## ğŸ› ï¸ STACK TECHNICZNY

### Frontend (DZIAÅA âœ…)

- Next.js 15 z App Router
- TypeScript
- Tailwind CSS
- WielojÄ™zycznoÅ›Ä‡: PL (domyÅ›lny), EN, DE
- Port: localhost:3000

### Backend (DZIAÅA âœ…)

- Fastify
- TypeScript
- CORS skonfigurowany dla localhost:3000
- Port: localhost:3001
- Nodemon dla auto-restart

### Baza Danych (W TRAKCIE KONFIGURACJI âš ï¸)

- **PostgreSQL** (USTALONO - nie SQLite!)
- Prisma ORM
- Schema gotowa (493 linie, peÅ‚ne modele CMMS)
- Problem: Brak dziaÅ‚ajÄ…cego poÅ‚Ä…czenia

## ğŸ“Š AKTUALNY STAN SYSTEMU

### âœ… CO DZIAÅA

1. **Frontend Next.js**:
   - Uruchamia siÄ™ na localhost:3000
   - WielojÄ™zycznoÅ›Ä‡ PL/EN/DE dziaÅ‚a
   - Komponenty React dziaÅ‚ajÄ…
   - Komunikacja z backendem dziaÅ‚a

2. **Backend Fastify**:
   - Uruchamia siÄ™ na localhost:3001
   - Endpointy dziaÅ‚ajÄ…:
     - `GET /health` - health check
     - `GET /api/status` - status API
     - `GET /api/system-status` - status systemu
   - CORS skonfigurowany
   - Logi dziaÅ‚ajÄ… poprawnie

3. **Komunikacja Frontend-Backend**:
   - Frontend pobiera dane z `/api/system-status`
   - Status wyÅ›wietla siÄ™ poprawnie:
     - ğŸŸ¢ API Server: "PoÅ‚Ä…czenie aktywne"
     - ğŸŸ¡ Baza danych: "Baza danych nie skonfigurowana"

### âœ… CO DZIAÅA - SYSTEM GOTOWY!

1. **Frontend Next.js** - âœ… PEÅNE DZIAÅANIE:
   - Uruchamia siÄ™ na localhost:3000
   - WielojÄ™zycznoÅ›Ä‡ PL/EN/DE dziaÅ‚a
   - Komponenty React dziaÅ‚ajÄ…
   - Komunikacja z backendem dziaÅ‚a
   - i18next skonfigurowane poprawnie

2. **Backend Fastify** - âœ… PEÅNE DZIAÅANIE:
   - Uruchamia siÄ™ na localhost:3001
   - Endpointy dziaÅ‚ajÄ…:
     - `GET /health` - health check
     - `GET /api/status` - status API
     - `GET /api/system-status` - status systemu
   - CORS skonfigurowany
   - PeÅ‚ne poÅ‚Ä…czenie z bazÄ… danych

3. **PostgreSQL 17** - âœ… PEÅNE DZIAÅANIE:
   - Port 5432 aktywny
   - HasÅ‚o: `8C5c3Aab5`
   - Baza `litecmms` utworzona
   - DATABASE_URL: `postgresql://postgres:8C5c3Aab5@localhost:5432/litecmms?schema=public`

4. **Prisma ORM** - âœ… PEÅNE DZIAÅANIE:
   - Migracje wykonane (`20250615205446_init`)
   - Wszystkie tabele CMMS utworzone
   - Prisma Client dziaÅ‚ajÄ…cy

5. **Komunikacja Frontend-Backend-Database** - âœ… PEÅNY ÅAÅƒCUCH:
   - Frontend â†’ Backend: OK
   - Backend â†’ Database: OK  
   - System Status: wszystkie komponenty "ok"

6. **System Automatyzacji** - âœ… PEÅNE DZIAÅANIE:
   - `npm run sys:start` - uruchamia system w osobnych oknach
   - `npm run sys:stop` - zatrzymuje wszystkie procesy
   - `npm run sys:status` - pokazuje peÅ‚ny status
   - `npm run sys:restart` - peÅ‚ny restart systemu
   - Automatyczne rozwiÄ…zywanie konfliktÃ³w portÃ³w
   - Niezawodne zarzÄ…dzanie procesami

### âœ… PROBLEMY ROZWIÄ„ZANE

1. **PostgreSQL instalacja** - âœ… ROZWIÄ„ZANE:
   - âœ… Repair Install PostgreSQL 17 wykonany
   - âœ… `postgres.exe` istnieje i dziaÅ‚a
   - âœ… UsÅ‚uga PostgreSQL uruchamia siÄ™ bez bÅ‚Ä™dÃ³w
   - âœ… Port 5432 odpowiada poprawnie

2. **DATABASE_URL konfiguracja** - âœ… CAÅKOWICIE ROZWIÄ„ZANE:
   - âœ… UsuniÄ™to BOM (Byte Order Mark) z pliku `database.env`
   - âœ… `dotenv.config()` teraz prawidÅ‚owo Å‚aduje DATABASE_URL
   - âœ… UsuniÄ™to hardkodowany fallback z `server/index.ts`
   - âœ… System uÅ¼ywa wyÅ‚Ä…cznie konfiguracji z pliku `database.env`
   - âœ… Logi potwierdzajÄ…: "âœ… DATABASE_URL zaÅ‚adowana z database.env"

3. **Migracje Prisma** - âœ… UKOÅƒCZONE:
   - âœ… Pierwsza migracja `20250615205446_init` wykonana
   - âœ… Wszystkie tabele CMMS utworzone w bazie

### ğŸ”„ NASTÄ˜PNE KROKI - ROZWÃ“J FUNKCJONALNOÅšCI

1. **Autoryzacja i uÅ¼ytkownicy**:
   - System logowania
   - 5 poziomÃ³w rÃ³l uÅ¼ytkownikÃ³w
   - JWT tokeny

2. **Pierwsze funkcjonalnoÅ›ci CMMS**:
   - ZarzÄ…dzanie maszynami
   - Zlecenia pracy
   - System zgÅ‚oszeÅ„

3. **Dashboard i raporty**:
   - GÅ‚Ã³wny dashboard
   - Podstawowe raporty

## ğŸ”§ KONFIGURACJA ÅšRODOWISKA

### Pliki konfiguracyjne

- `package.json` - zaleÅ¼noÅ›ci i skrypty
- `prisma/schema.prisma` - schema bazy danych (PostgreSQL)
- `docker-compose.yml` - konfiguracja PostgreSQL (nie uÅ¼ywane obecnie)
- `server/index.ts` - gÅ‚Ã³wny plik serwera
- `app/page.tsx` - gÅ‚Ã³wna strona frontendu

### Porty

- Frontend: 3000
- Backend: 3001
- PostgreSQL: 5432 (gdy bÄ™dzie dziaÅ‚aÄ‡)

### Skrypty npm

- `npm run dev` - frontend
- `npm run dev:server` - backend
- `npx prisma generate` - generowanie Prisma Client

## ğŸ“ HISTORIA ROZWOJU

### Faza 1: Podstawowa infrastruktura (UKOÅƒCZONA âœ…)

- Utworzono minimalny serwer Fastify
- Dodano CORS
- Dodano podstawowe endpointy
- Przetestowano komunikacjÄ™ frontend-backend

### Faza 2: Baza danych (UKOÅƒCZONA âœ…)

- âœ… PostgreSQL 17 w peÅ‚ni zainstalowany
- âœ… HasÅ‚o uÅ¼ytkownika `postgres`: `8C5c3Aab5`
- âœ… **DATABASE_URL caÅ‚kowicie rozwiÄ…zane** (prawidÅ‚owe Å‚adowanie z `database.env`)
- âœ… Migracje Prisma wykonane
- âœ… Baza `litecmms` utworzona z peÅ‚nÄ… strukturÄ… CMMS

### Faza 3: Integracja i testy (UKOÅƒCZONA âœ…)

- âœ… PoÅ‚Ä…czenie Frontend-Backend-Database w peÅ‚ni dziaÅ‚ajÄ…ce
- âœ… Status systemu pokazuje wszystkie komponenty jako "ok"
- âœ… Podstawowa infrastruktura gotowa do rozwoju funkcjonalnoÅ›ci

### Faza 4: WielojÄ™zycznoÅ›Ä‡ i UI (UKOÅƒCZONA âœ…)

- âœ… **UsuniÄ™te wszystkie hardkodowane teksty** z interfejsu
- âœ… Kompletne tÅ‚umaczenia dla 3 jÄ™zykÃ³w (PL/EN/DE)
- âœ… Dodane klucze: `descriptions.*`, `systemInfo.*`
- âœ… DziaÅ‚ajÄ…ce przeÅ‚Ä…czanie jÄ™zykÃ³w bez bÅ‚Ä™dÃ³w hydratacji
- âœ… Wszystkie elementy UI uÅ¼ywajÄ… kluczy tÅ‚umaczeÅ„

### Faza 5: System Automatyzacji (UKOÅƒCZONA âœ…)

- âœ… **System automatycznego zarzÄ…dzania procesami**
- âœ… **RozwiÄ…zanie problemu DATABASE_URL** (caÅ‚kowita naprawa konfiguracji)
- âœ… Niezawodne skrypty PowerShell bez problemÃ³w z kodowaniem
- âœ… Automatyczne rozwiÄ…zywanie konfliktÃ³w portÃ³w
- âœ… Kompletny system testowania i diagnostyki
- âœ… 8 nowych komend npm do zarzÄ…dzania systemem
- âœ… **Naprawione problemy PowerShell Analyzer** (nieuÅ¼ywane zmienne)
- âœ… **Poprawione testy frontendu** (usuniÄ™to konflikt z backendem)
- âš ï¸ **Problem z podwÃ³jnym uruchamianiem** - czasami skrypty uruchamiajÄ… siÄ™ wielokrotnie

### Faza 6: Naprawa DATABASE_URL i odkrycie autoryzacji (UKOÅƒCZONA âœ…)

- âœ… **Zdiagnozowano problem BOM** w pliku `database.env`
- âœ… **UsuniÄ™to BOM** - `dotenv.config()` teraz dziaÅ‚a poprawnie
- âœ… **UsuniÄ™to hardkodowany fallback** z `server/index.ts`
- âœ… **DATABASE_URL prawidÅ‚owo Å‚adowana** z pliku konfiguracyjnego
- âœ… **Odkryto kompletny system autoryzacji**:
  - `server/routes/auth.ts` - endpointy login/register/logout/refresh
  - `server/middleware/auth.ts` - JWT middleware + kontrola rÃ³l
  - 5 poziomÃ³w rÃ³l uÅ¼ytkownikÃ³w gotowych
  - Bcrypt + JWT + refresh tokeny zaimplementowane
  - **Status**: Napisane ale jeszcze nie zintegrowane z gÅ‚Ã³wnym serwerem

### PrÃ³by ktÃ³re NIE DZIAÅAÅY âŒ

- SQLite - zbyt wiele ograniczeÅ„ (brak Json, enum, Decimal)
- Docker - problemy z uruchomieniem Docker Desktop
- **Plik `.env`** - nie istnieje, nie jest uÅ¼ywany
- **Plik `database.env`** - istnieje i jest Å‚adowany przez dotenv, ale system uÅ¼ywa gÅ‚Ã³wnie hardkodowanego fallbacka

## ğŸ¯ METODOLOGIA PRACY

### Wymagania uÅ¼ytkownika

1. **MaÅ‚e kroki z testami** - kaÅ¼da zmiana musi byÄ‡ testowana
2. **Nie tworzyÄ‡ mock danych** - tylko prawdziwe rozwiÄ…zania
3. **PostgreSQL, nie SQLite** - ustalono definitywnie
4. **BezpieczeÅ„stwo** - wszystko ma byÄ‡ bezpieczne
5. **Cofanie zmian** - gdy coÅ› nie dziaÅ‚a, wrÃ³ciÄ‡ do ostatniego dziaÅ‚ajÄ…cego stanu

### PodejÅ›cie do problemÃ³w

- Gdy coÅ› siÄ™ komplikuje - STOP i powrÃ³t do podstaw
- Testowanie po kaÅ¼dej zmianie
- Jasne komunikowanie co dziaÅ‚a, a co nie
- Unikanie chaotycznych zmian
- Nigdy nie zmieniaÄ‡ kodu bez potrzeby, rozwiÄ…zuj jeden problem na raz.

### âš ï¸ ZASADY KODOWANIA - OBOWIÄ„ZKOWE!

1. **Å»ADNEGO HARDKODOWANIA** - wszystkie teksty muszÄ… byÄ‡ w plikach tÅ‚umaczeÅ„:
   - âŒ `<p>ZarzÄ…dzanie maszynami</p>` 
   - âœ… `<p>{t('descriptions.machines')}</p>`
   - Sprawdzaj pliki `locales/*/common.json` przed dodaniem nowych tekstÃ³w
   - Dodawaj brakujÄ…ce klucze do WSZYSTKICH jÄ™zykÃ³w (PL/EN/DE)

2. **WielojÄ™zycznoÅ›Ä‡**:
   - KaÅ¼dy nowy tekst = nowy klucz w `common.json`
   - Struktura kluczy: `sekcja.element` (np. `descriptions.machines`)
   - Wszystkie 3 jÄ™zyki muszÄ… mieÄ‡ peÅ‚ne tÅ‚umaczenia

3. **Konsystencja**:
   - UÅ¼ywaj istniejÄ…cych kluczy zamiast tworzyÄ‡ nowe
   - Sprawdzaj czy klucz juÅ¼ istnieje przed dodaniem
   - Zachowuj strukturÄ™ hierarchicznÄ… kluczy

## ğŸ”§ SYSTEM AUTOMATYZACJI - INSTRUKCJE

### DostÄ™pne komendy npm:

#### GÅ‚Ã³wny system (ZALECANE):

```bash
npm run sys:start    # Uruchom caÅ‚y system (backend + frontend)
npm run sys:stop     # Zatrzymaj wszystkie procesy
npm run sys:restart  # Restart caÅ‚ego systemu
npm run sys:status   # SprawdÅº status wszystkich komponentÃ³w
```

#### Komendy backup (stare):

```bash
npm run quick-start  # âš ï¸ PROBLEM: uÅ¼ywa niestabilnych PowerShell Jobs
npm run stop-all     # âœ… DZIAÅA: zatrzymuje wszystkie procesy
npm run status       # âœ… DZIAÅA: status check (po naprawie emoji)
npm run reset        # âš ï¸ MOÅ»E NIE DZIAÅAÄ†: peÅ‚ny reset
```

### Typowy workflow developmentu:

```bash
# Rano - uruchom system
npm run sys:start

# SprawdÅº czy wszystko dziaÅ‚a
npm run sys:status

# Podczas pracy - jeÅ›li coÅ› nie gra
npm run sys:restart

# Na koniec dnia
npm run sys:stop
```

### RozwiÄ…zywanie problemÃ³w:

```bash
# Problem z systemem
npm run sys:stop
npm run sys:start

# SprawdÅº szczegÃ³Å‚y
npm run sys:status

# JeÅ›li nadal problemy - uruchom rÄ™cznie
npm run dev:server  # w jednym terminalu
npm run dev         # w drugim terminalu
```

### âš ï¸ WAÅ»NE ROZWIÄ„ZANIA:

1. **Problem DATABASE_URL**: âœ… **CAÅKOWICIE ROZWIÄ„ZANY** - usuniÄ™to BOM, prawidÅ‚owe Å‚adowanie z `database.env`
2. **Konflikt portÃ³w**: System automatycznie sprawdza i rozwiÄ…zuje
3. **Niestabilne procesy**: Nowy system-manager.ps1 jest niezawodny
4. **Kodowanie znakÃ³w**: Wszystkie skrypty bez znakÃ³w specjalnych
5. **PowerShell Analyzer**: Naprawione ostrzeÅ¼enia o nieuÅ¼ywanych zmiennych
6. **Test frontendu**: Poprawiona logika testowania (usuniÄ™to konflikt z backendem)
7. **PodwÃ³jne uruchamianie**: Problem wystÄ™puje przy przerwanych komendach

## ğŸš€ NASTÄ˜PNE KROKI - ROZWÃ“J FUNKCJONALNOÅšCI

### âœ… INFRASTRUKTURA - W PEÅNI UKOÅƒCZONA

1. âœ… PostgreSQL 17 dziaÅ‚ajÄ…cy
2. âœ… Backend Fastify z Prisma 
3. âœ… Frontend Next.js z i18n
4. âœ… PeÅ‚ne poÅ‚Ä…czenie Frontend-Backend-Database
5. âœ… Migracje i struktura bazy CMMS
6. âœ… **System automatyzacji procesÃ³w**
7. âœ… **DATABASE_URL prawidÅ‚owo skonfigurowane** (bez hardkodowania)

### Priorytet 1: Integracja gotowego systemu autoryzacji

1. âœ… Model uÅ¼ytkownikÃ³w w Prisma - GOTOWY
2. âœ… Endpointy rejestracji/logowania - NAPISANE
3. âœ… JWT middleware - NAPISANE
4. âœ… 5 poziomÃ³w rÃ³l - ZAIMPLEMENTOWANE
5. ğŸ”„ **NASTÄ˜PNE**: Integracja z gÅ‚Ã³wnym serwerem:
   - Rejestracja middleware autoryzacji
   - Rejestracja route'Ã³w `/api/auth/*`
   - Konfiguracja JWT i bcrypt w Fastify
   - Testy endpointÃ³w autoryzacji

### Priorytet 2: Pierwsze funkcjonalnoÅ›ci CMMS

1. ZarzÄ…dzanie maszynami i urzÄ…dzeniami
2. System zgÅ‚oszeÅ„ awarii
3. Zlecenia pracy (Work Orders)
4. Podstawowy kalendarz konserwacji

### Priorytet 3: Dashboard i raporty

1. GÅ‚Ã³wny dashboard z kluczowymi metrykami
2. Podstawowe raporty (awarie, konserwacje)
3. Wykresy i wizualizacje danych

## ğŸ” DIAGNOSTYKA

### Sprawdzanie statusu
- Frontend: http://localhost:3000
- Backend: http://localhost:3001/api/system-status
- Health check: http://localhost:3001/health

### Logi
- Backend logi w konsoli (Fastify + nodemon)
- Frontend logi w przeglÄ…darce (React DevTools)

### Typowe problemy
- Port 3001 zajÄ™ty - restart serwera
- CORS errors - sprawdziÄ‡ konfiguracjÄ™
- Baza danych - sprawdziÄ‡ poÅ‚Ä…czenie w `/api/system-status`

## ğŸ’¡ WSKAZÃ“WKI DLA AI

### Co robiÄ‡ na poczÄ…tku sesji
1. SprawdÅº aktualny status systemu
2. Przeczytaj logi z terminala
3. Przetestuj endpointy
4. Zapytaj o aktualny problem

### âš ï¸ PROBLEMY ÅšRODOWISKA - ZAPAMIÄ˜TAJ!
1. **PowerShell ma problemy z PSReadLine** - bÅ‚Ä™dy konsoli, nie ma co walczyÄ‡, uÅ¼ywaj prostych komend
2. **Brak pliku `.env`** - backend uÅ¼ywa `database.env` + hardkodowany fallback w kodzie
3. **PostgreSQL instalacja jest uszkodzona** - brak plikÃ³w exe, problemy z usÅ‚ugÄ…
4. **Potrzeba uprawnieÅ„ administratora** - wiele operacji wymaga "Run as Administrator"

### SPÃ“JNOÅšÄ† W DORADZTWIE
- **NIE ZMIENIAJ** podejÅ›cia w trakcie sesji (Docker vs lokalnie)
- **PAMIÄ˜TAJ** o wczeÅ›niejszych prÃ³bach i bÅ‚Ä™dach  
- **DOKUMENTUJ** wszystkie nieudane prÃ³by w sekcji "PrÃ³by ktÃ³re NIE DZIAÅAÅY"

### âš ï¸ PRZED KOÅƒCEM SESJI - OBOWIÄ„ZKOWE!
**ZAWSZE przed koÅ„cem limitu chatu:**

1. **Zaktualizuj AI_CONTEXT.md**:
   - Dodaj nowe osiÄ…gniÄ™cia do sekcji "CO DZIAÅA âœ…"
   - Zaktualizuj sekcjÄ™ "CO WYMAGA DOKOÅƒCZENIA âš ï¸"
   - Dodaj nowe problemy/rozwiÄ…zania do "HISTORIA ROZWOJU"
   - Zaktualizuj "NASTÄ˜PNE KROKI"

2. **Zaktualizuj README.md** (jeÅ›li potrzeba):
   - Nowe instrukcje instalacji
   - Zmiany w strukturze projektu
   - Nowe endpointy/funkcjonalnoÅ›ci

3. **Poinformuj uÅ¼ytkownika**:
   - "ğŸ”„ **AKTUALIZUJÄ˜ PLIKI KONTEKSTU** przed koÅ„cem sesji"
   - Podsumuj co zostaÅ‚o zrobione
   - WskaÅ¼ co trzeba kontynuowaÄ‡ w nastÄ™pnej sesji

**PrzykÅ‚ad komunikatu:**
> ğŸ”„ **AKTUALIZUJÄ˜ PLIKI KONTEKSTU** przed koÅ„cem sesji  
> âœ… **OsiÄ…gniÄ™cia**: PostgreSQL zainstalowany, baza poÅ‚Ä…czona  
> âš ï¸ **Do kontynuacji**: Pierwsze migracje Prisma  
> ğŸ“ **Pliki zaktualizowane**: AI_CONTEXT.md, README.md

### Czego unikaÄ‡
- Nie tworzyÄ‡ nowych plikÃ³w bez potrzeby
- Nie zmieniaÄ‡ dziaÅ‚ajÄ…cych czÄ™Å›ci
- Nie proponowaÄ‡ SQLite zamiast PostgreSQL
- Nie robiÄ‡ duÅ¼ych zmian bez testÃ³w
- **NIE KOÅƒCZYÄ† SESJI bez aktualizacji kontekstu!**
- **NIGDY nie hardkodowaÄ‡ tekstÃ³w** - zawsze uÅ¼ywaÄ‡ kluczy tÅ‚umaczeÅ„
- **NIE TWORZYÄ† nowych kluczy** bez sprawdzenia czy juÅ¼ istniejÄ…

### Styl komunikacji
- Zawsze po polsku
- Konkretne kroki z testami
- Jasne oznaczanie co dziaÅ‚a (âœ…) i co nie (âŒ)
- Emoji dla lepszej czytelnoÅ›ci

---

**Ostatnia aktualizacja**: StyczeÅ„ 2025 - Faza 6 ukoÅ„czona  
**Wersja kontekstu**: 1.1  
**Status**: Aktualny - DATABASE_URL naprawiona, system autoryzacji odkryty 